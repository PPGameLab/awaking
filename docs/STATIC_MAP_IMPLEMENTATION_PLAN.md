# –ü–ª–∞–Ω –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –°—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –ö–∞—Ä—Ç—ã

**–ù–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:** `questions/static_map_questions.md`

---

## üìä –ê–Ω–∞–ª–∏–∑ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –†–µ—à–µ–Ω–∏—è:

1. **–ú–∞—Å—à—Ç–∞–±:** MVP ~100-250 —É–∑–ª–æ–≤, —Ä–∞—Å—à–∏—Ä—è–µ–º–æ –¥–æ 1000+
2. **–§–æ—Ä–º–∞—Ç:** `data/maps/world_v1.json` - –æ–¥–∏–Ω —Ñ–∞–π–ª, nodes –∫–∞–∫ dict, edges –∫–∞–∫ list
3. **–£–∑–ª—ã:** –ú–∏–Ω–∏–º—É–º - id, name, pos, tags, owner_id. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: ui, meta (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
4. **–†—ë–±—Ä–∞:** –ú–∏–Ω–∏–º—É–º - from, to, length_km. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: road_type, biome, tags
5. **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** World units, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∫–∞–º–µ—Ä–æ–π, –≥—Ä–∞–Ω–∏—Ü—ã –≤ metadata
6. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** Viewer –∫–∞—Ä—Ç—ã (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç), –≤–∞–ª–∏–¥–∞—Ç–æ—Ä
7. **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä:** –£–±—Ä–∞—Ç—å –∏–∑ runtime, –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ dev-tool

---

## üéØ –≠—Ç–∞–ø 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)

### 1.1 –û–±–Ω–æ–≤–∏—Ç—å Node –∫–ª–∞—Å—Å

**–§–∞–π–ª:** `src/entities/node.py`

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
@dataclass
class Node:
    id: str
    name: str
    pos: tuple[float, float]
    node_type: str
    kingdom: Optional[str] = None
    role: Optional[str] = None
```

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
@dataclass
class Node:
    id: str
    name: str
    pos: tuple[float, float]  # (x, y) –≤ world units
    tags: List[str] = field(default_factory=list)  # –î–ª—è —Ä–æ–ª–µ–π, —Å–æ–±—ã—Ç–∏–π, –±–∏–æ–º–æ–≤
    owner_id: Optional[str] = None  # faction_id (–±—ã–ª–æ kingdom)
    
    # –î–ª—è –±—É–¥—É—â–µ–≥–æ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ª–æ–≥–∏–∫–µ MVP)
    ui: Optional[Dict] = None  # {icon?, color?, size?}
    meta: Optional[Dict] = None  # {importance?, lore?}
    
    # –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (deprecated, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tags)
    node_type: Optional[str] = None
    kingdom: Optional[str] = None
    role: Optional[str] = None
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `tags: List[str]` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å `kingdom` –Ω–∞ `owner_id` (faction_id)
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `ui` –∏ `meta` –¥–ª—è –±—É–¥—É—â–µ–≥–æ
- ‚ö†Ô∏è –û—Å—Ç–∞–≤–∏—Ç—å `node_type`, `kingdom`, `role` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (deprecated)

---

### 1.2 –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä—ë–±–µ—Ä –≤ World

**–§–∞–π–ª:** `src/core/world.py`

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
self.edges: List[Tuple[str, str]] = []  # (from, to)
```

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
@dataclass
class Edge:
    from_id: str
    to_id: str
    # length_km –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —É–∑–ª–æ–≤
    road_type: Optional[str] = None  # main, secondary, path, center
    biome: Optional[str] = None
    tags: List[str] = field(default_factory=list)
    blocked_until: Optional[float] = None  # timestamp –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    
    def get_length_km(self, world: 'World', km_per_unit: float = 0.1) -> float:
        """–í—ã—á–∏—Å–ª—è–µ—Ç –¥–ª–∏–Ω—É —Ä–µ–±—Ä–∞ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö"""
        from_node = world.nodes.get(self.from_id)
        to_node = world.nodes.get(self.to_id)
        if not from_node or not to_node:
            return 0.0
        distance_units = from_node.distance_to(to_node)
        return distance_units * km_per_unit

self.edges: List[Edge] = []
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dataclass `Edge` –¥–ª—è —è–≤–Ω–æ—Å—Ç–∏. `length_km` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —É–∑–ª–æ–≤ –∏ `km_per_unit` –∏–∑ metadata.

---

### 1.3 –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ world_v1.json

**–§–∞–π–ª:** `data/maps/world_v1.json`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```json
{
  "metadata": {
    "version": "1.0",
    "schema_version": "1",
    "created_at": "2026-01-17T00:00:00Z",
    "updated_at": "2026-01-17T00:00:00Z",
    "bounds": {
      "min_x": 0.0,
      "max_x": 1000.0,
      "min_y": 0.0,
      "max_y": 1000.0
    },
    "km_per_unit": 0.1,
    "notes": "Static map for MVP"
  },
  "nodes": {
    "Node1": {
      "id": "Node1",
      "name": "–£–∑–µ–ª 1",
      "pos": [400.0, 300.0],
      "tags": ["city", "settlement"],
      "owner_id": "Kingdom1",
      "ui": {
        "icon": null,
        "color": null,
        "size": null
      },
      "meta": {
        "importance": null,
        "lore": null
      }
    }
  },
  "edges": [
    {
      "from": "Node1",
      "to": "Node2",
      "road_type": "main",
      "biome": null,
      "tags": []
    }
  ],
  "config": {
    "km_per_unit": 0.1
  }
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- `nodes` –∫–∞–∫ dict (—É–¥–æ–±–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏)
- `edges` –∫–∞–∫ list (–º–µ–Ω—å—à–µ —à–∞–Ω—Å –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å)
- `length_km` –ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è - –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —É–∑–ª–æ–≤ –∏ `km_per_unit`
- –í—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã, –∫—Ä–æ–º–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö (id, name, pos –¥–ª—è —É–∑–ª–æ–≤; from, to –¥–ª—è —Ä—ë–±–µ—Ä)
- `km_per_unit` –≤ metadata –∏–ª–∏ config - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ world units –≤ –∫–∏–ª–æ–º–µ—Ç—Ä—ã

---

## üîß –≠—Ç–∞–ø 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ó–∞–≥—Ä—É–∑—á–∏–∫–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–∞

### 2.1 –û–±–Ω–æ–≤–∏—Ç—å MapLoader

**–§–∞–π–ª:** `src/utils/map_loader.py`

**–ó–∞–¥–∞—á–∏:**
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ `world_v1.json`
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ nodes –∫–∞–∫ dict
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ edges —Å edge_data
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º (simple_map.json)

**–ú–µ—Ç–æ–¥—ã:**
```python
def load_world_map(self, map_name: str = "world_v1") -> Tuple[Dict[str, Node], List[Edge], Dict]:
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ä—Ç—É –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"""
    
def load_legacy_map(self, map_name: str) -> Tuple[Dict[str, Node], List[Tuple[str, str]], Dict]:
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ä—Ç—É –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)"""
```

---

### 2.2 –û–±–Ω–æ–≤–∏—Ç—å MapStorage

**–§–∞–π–ª:** `src/utils/map_storage.py`

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Edge dataclass
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç bounds –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —É–∑–ª–æ–≤

---

## ‚úÖ –≠—Ç–∞–ø 3: –í–∞–ª–∏–¥–∞—Ç–æ—Ä –ö–∞—Ä—Ç—ã

### 3.1 –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–§–∞–π–ª:** `scripts/validate_map.py`

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å ID —É–∑–ª–æ–≤
- [ ] –í—Å–µ —Ä—ë–±—Ä–∞ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–∑–ª—ã
- [ ] –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ä—ë–±–µ—Ä (A-B == B-A)
- [ ] –ö–∞—Ä—Ç–∞ —Å–≤—è–∑–Ω–∞ (–∏–ª–∏ —Ö–æ—Ç—è –±—ã –±–æ–ª—å—à–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–≤—è–∑–Ω–æ—Å—Ç–∏)
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–µ–ø–µ–Ω–∏ —É–∑–ª–æ–≤
- [ ] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- [ ] –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

**–í—ã–≤–æ–¥:**
```
Map validation: world_v1.json
‚úì Unique node IDs: 150
‚úì All edges reference existing nodes
‚úì No duplicate edges
‚úì Map is connected (1 component, 150 nodes)
‚úì Node degree stats: min=1, max=8, avg=3.2
‚úì Coordinates in range: x=[0, 2000], y=[0, 2000]
```

---

## üé® –≠—Ç–∞–ø 4: Viewer –ö–∞—Ä—Ç—ã

### 4.1 –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –∫–∞—Ä—Ç—ã

**–§–∞–π–ª:** `scripts/view_map.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞
- [ ] –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —É–∑–ª–æ–≤ –∏ —Ä—ë–±–µ—Ä (matplotlib –∏–ª–∏ pygame)
- [ ] –ö–ª–∏–∫–∏ –ø–æ —É–∑–ª–∞–º (–ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é)
- [ ] –ü–æ–∏—Å–∫ –ø—É—Ç–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ (A*)
- [ ] –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python scripts/view_map.py world_v1
python scripts/view_map.py world_v1 --interactive
python scripts/view_map.py world_v1 --export map.png
```

---

## üîÑ –≠—Ç–∞–ø 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ World –∫–ª–∞—Å—Å–∞

### 5.1 –û–±–Ω–æ–≤–∏—Ç—å World –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–§–∞–π–ª:** `src/core/world.py`

**–ó–∞–¥–∞—á–∏:**
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Edge dataclass
- [ ] –ú–µ—Ç–æ–¥ `get_edge_data(from, to)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–±—Ä–∞
- [ ] –ú–µ—Ç–æ–¥ `calculate_travel_time(squad, edge)` –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–≤–∏–∂–µ–Ω–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `find_path()` –¥–ª—è —É—á—ë—Ç–∞ length_km –∏ road_type
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ adjacency list –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–ú–µ—Ç–æ–¥—ã:**
```python
def get_edge_data(self, from_id: str, to_id: str) -> Optional[Edge]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ä–µ–±—Ä–∞"""
    
def get_edge_length_km(self, edge: Edge) -> float:
    """–í—ã—á–∏—Å–ª—è–µ—Ç –¥–ª–∏–Ω—É —Ä–µ–±—Ä–∞ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö"""
    km_per_unit = self.metadata.get("km_per_unit", 0.1)
    return edge.get_length_km(self, km_per_unit)
    
def calculate_travel_time(self, squad: Squad, edge: Edge) -> float:
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ —Ä–µ–±—Ä—É"""
    length_km = self.get_edge_length_km(edge)
    road_multiplier = self.get_road_multiplier(edge.road_type)
    # time_hours = length_km / (squad_speed_kmh * road_multiplier)
    
def get_map_bounds(self) -> Dict[str, float]:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã –∏–∑ metadata"""
```

---

## üìù –≠—Ç–∞–ø 6: –ú–∏–≥—Ä–∞—Ü–∏—è –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 6.1 –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É

**–§–∞–π–ª:** `data/maps/world_v1.json`

**–°–æ–∑–¥–∞—Ç—å:**
- –ù–µ–±–æ–ª—å—à—É—é —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É (10-20 —É–∑–ª–æ–≤)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å viewer

---

### 6.2 –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

**–§–∞–π–ª—ã:**
- `main_pygame.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
- `src/core/game.py` - –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∫–∞—Ä—Ç—ã
- –£–±—Ä–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑ runtime (–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ dev-tool)

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã MVP

### –ú–∏–Ω–∏–º—É–º –¥–ª—è MVP:
1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å Node (tags, owner_id)
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å Edge dataclass
3. ‚úÖ –§–æ—Ä–º–∞—Ç world_v1.json
4. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å MapLoader
5. ‚úÖ Viewer –∫–∞—Ä—Ç—ã (–±–∞–∑–æ–≤—ã–π)
6. ‚úÖ –í–∞–ª–∏–¥–∞—Ç–æ—Ä (–±–∞–∑–æ–≤—ã–π)

### –ú–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å:
- UI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (icon, color, size)
- Meta –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (importance, lore)
- Biome –Ω–∞ —Ä—ë–±—Ä–∞—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `Node` –∫–ª–∞—Å—Å (tags, owner_id, ui, meta)
- [ ] –°–æ–∑–¥–∞—Ç—å `Edge` dataclass
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `World.edges` –Ω–∞ `List[Edge]`
- [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä `world_v1.json`

### –≠—Ç–∞–ø 2: –ó–∞–≥—Ä—É–∑–∫–∞
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `MapLoader.load_world_map()`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `MapStorage.save_map()` –¥–ª—è Edge
- [ ] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º

### –≠—Ç–∞–ø 3: –í–∞–ª–∏–¥–∞—Ü–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å `scripts/validate_map.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–µ

### –≠—Ç–∞–ø 4: Viewer
- [ ] –°–æ–∑–¥–∞—Ç—å `scripts/view_map.py`
- [ ] –ë–∞–∑–æ–≤–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–∫–ª–∏–∫–∏, –ø—É—Ç—å)

### –≠—Ç–∞–ø 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `World` –¥–ª—è Edge
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `main_pygame.py`
- [ ] –£–±—Ä–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑ runtime

### –≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å viewer
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∏–≥—Ä–µ

---

## üí° –í–∞—Ä–∏–∞–Ω—Ç—ã –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç

### –†–µ—à–µ–Ω–∏–µ: –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –µ–¥–∏–Ω–∏—Ü—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á—ë—Ç–æ–º
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ "world units" (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0-2000)
- `km_per_unit` –≤ metadata/config (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.1 –∫–º/unit)
- `length_km = distance_units * km_per_unit` (–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å length_km –≤ —Ñ–∞–π–ª–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ km_per_unit
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í Edge –∫–ª–∞—Å—Å–µ
def get_length_km(self, world: 'World', km_per_unit: float) -> float:
    from_node = world.nodes[self.from_id]
    to_node = world.nodes[self.to_id]
    distance_units = from_node.distance_to(to_node)
    return distance_units * km_per_unit
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. **–ù–∞—á–∞—Ç—å —Å –≠—Ç–∞–ø–∞ 1** - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
2. **–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É** - world_v1.json —Å 10-20 —É–∑–ª–∞–º–∏
3. **–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
4. **–°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
5. **–°–æ–∑–¥–∞—Ç—å viewer** - –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
6. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É** - –æ–±–Ω–æ–≤–∏—Ç—å World –∏ main_pygame.py
