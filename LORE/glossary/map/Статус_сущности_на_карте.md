Status: DRAFT  
ID: map_entity_status  

# Статус сущности на карте

## Кратко
Статус сущности на карте — это пространственное состояние сущности, определяющее,
какие действия карты допустимы по отношению к данной сущности в текущий момент времени.

Статус используется картой для управления движением, обнаружением и встречами,
но не отражает причин, намерений или внутренних процессов сущности.

---

## Инварианты

### 1. У каждой сущности всегда есть ровно один статус  
Сущность на карте всегда находится **ровно в одном пространственном статусе**.

Отсутствие статуса или одновременное наличие нескольких статусов недопустимо.

---

### 2. Статус определяет допустимые процессы карты  
Статус сущности определяет:
- может ли сущность двигаться,
- может ли быть обнаружена,
- может ли участвовать во встречах,
- может ли изменять позицию.

Карта **не исполняет** процессы, запрещённые текущим статусом сущности.

---

### 3. Статус не является поведением  
Статус:
- не определяет намерения,
- не задаёт целей,
- не содержит логики принятия решений.

Статус — это режим участия сущности в пространственной логике карты.

---

### 4. Изменение статуса контролируется картой  
Изменение статуса:
- инициируется картой в результате пространственных событий (встреча, достижение узла и т.п.),
- либо по внешнему сигналу (завершение боя, события и т.п.).

Контролёры **не изменяют статус напрямую**, а лишь реагируют на его изменение.

---

### 5. Статусы только у зарегистрированных сущностей  
Статусы применимы только к сущностям, зарегистрированным в карте мира.

Сущность, отсутствующая на карте, не имеет позиции и пространственного статуса.

---

## Минимальный набор пространственных статусов (MVP)

### 1. `Idle`
Сущность:
- находится в узле,
- не движется,
- может быть обнаружена,
- может участвовать во встречах.

Это базовый “ожидающий” статус.

---

### 2. `Moving`
Сущность:
- находится на ребре или начинает движение из узла,
- позиция изменяется по логике движения,
- может быть обнаружена,
- может участвовать во встречах (с ограничениями).

---

### 3. `Engaged`
Сущность:
- участвует во встрече или внешнем процессе,
- движение остановлено,
- позиция зафиксирована,
- обнаружение и новые встречи запрещены (если не указано иное).

Используется для боёв, диалогов и иных внешних взаимодействий.

---

### 4. `Disabled`
Сущность:
- присутствует на карте,
- не может двигаться,
- не может участвовать во встречах,
- может быть временно удалена из пространственного слоя карты и не участвовать в пространственных процессах до повторной регистрации.

Пример: оглушение, блокировка, особые состояния.

---

## Переходы статусов

Переходы между статусами:
- осуществляются картой,
- происходят на границах тиков или при обработке внешних сигналов,
- не должны приводить к неопределённым состояниям.

Конкретные правила переходов — TBD.

---

## Границы ответственности

Статус сущности на карте **не**:
- отражает боевые состояния (HP, эффекты и т.п.),
- не описывает AI-состояния,
- не управляет временем занятости,
- не заменяет механику событий и боёв.

Статус существует **исключительно для пространственной логики карты**.

---

## Примечания (TBD)

- Вход сущности во внутреннее пространство точки интереса (например, города) приводит к её дерегистрации из карты, а не к изменению пространственного статуса.
- Возможность расширения набора статусов — TBD.
- Правила взаимодействия нескольких сущностей в одном статусе — TBD.
- Исключения и специальные статусы — TBD.
