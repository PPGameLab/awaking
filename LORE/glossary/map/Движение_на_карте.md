Status: DRAFT  
ID: map_movement  

# Движение на карте

## Кратко
Движение на карте — это процесс изменения позиции сущности во времени, исполняемый картой мира на основе внешних намерений и приводящий к переходам между узлами и рёбрами графа.

Движение является **пространственным процессом**, не содержащим в себе причин, мотиваций или стратегических решений.

---

## Инварианты

### 1. Движение исполняется только картой  
Движение сущности:
- инициируется на основе намерений, полученных картой извне,
- исполняется **исключительно картой мира**,
- приводит к изменению позиции сущности (узел ↔ ребро ↔ узел).

Ни контролёры, ни внешние системы не изменяют позицию напрямую.

---

### 2. Движение привязано к позиции  
Движение всегда начинается из корректной позиции на карте:
- либо из узла,
- либо с текущего положения на ребре.

Если сущность находится на ребре, она может:
- продолжить движение к одному из двух узлов, связанных данным ребром;
- изменить направление движения на этом же ребре.

Переход на иное ребро возможен только после достижения узла.

Результатом движения является:
- обновлённый прогресс на текущем ребре,
- переход в целевой узел,
- либо начало движения по следующему ребру маршрута.

---

### 3. Движение дискретно по логике  
Логика движения обновляется **по тикам карты**.

На каждом тике карта:
- определяет, допускает ли текущий статус сущности движение,
- применяет движение в соответствии с активным намерением,
- обновляет позицию сущности.

Визуальная плавность между тиками достигается интерполяцией и не влияет на логику карты.

---

### 4. Намерение как вход движения  
Движение не имеет собственной цели.

Для исполнения движения карта использует:
- актуальное намерение сущности, полученное от контролёра,
- параметры сущности, влияющие на скорость и доступность движения.

Если намерение отсутствует или движение запрещено статусом, позиция сущности не изменяется.

---

### 5. Движение по рёбрам графа  
При движении по графу:
- сущность может находиться на одном ребре в каждый момент времени,
- движение по ребру выражается через изменение параметра прогресса,
- завершение движения по ребру приводит к переходу в целевой узел.

Сущность не может одновременно находиться на нескольких рёбрах или узлах.

---

### 6. Взаимодействие движения и встреч  
Движение является предпосылкой для:
- обнаружения,
- встреч и перехватов.

Карта может:
- прервать движение сущности,
- изменить её пространственный статус,

если в результате движения были выполнены условия встречи или получен внешний сигнал.

---

## Границы ответственности

Движение на карте **не**:
- определяет маршрут движения,
- не выбирает цель,
- не принимает решений о смене направления,
- не управляет длительностью занятости сущности.

Движение является исполнением, а не решением.

---

## Примечания (TBD)

- Формат и типы намерений, используемых для движения — TBD.
- Связь параметров сущности (скорость, эффекты) с величиной изменения прогресса — TBD.
- Правила приостановки и возобновления движения — TBD.
